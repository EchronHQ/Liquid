<?php
declare(strict_types=1);

use Liquid\Blog\Model\ViewModel\CategoryViewViewModel;
use Liquid\Blog\Model\ViewModel\PostList;
use Liquid\Blog\Model\ViewModel\Tag;
use Liquid\Content\Model\Asset\AssetSizeInstruction;
use Liquid\Content\ViewModel\BaseViewModel;
use Liquid\Content\ViewModel\TagBar;
use Liquid\Framework\View\Element\Template;
use Liquid\Framework\View\TemplateEngine;

/**
 * @var $this TemplateEngine
 * @var $block Template
 * @var $viewModel CategoryViewViewModel
 * @var $baseViewModel BaseViewModel
 */
$viewModel = $block->getViewModel('', Tag::class);
$baseViewModel = $block->getViewModel('base', BaseViewModel::class);

$category = $viewModel->getCategory();
$posts = $viewModel->getPosts();
?>

<page-header>

    <div class="row">
        <div class="column col-3-1">
            <copy-block types="header" caption="Blog" title="<?= $category->title_long ?>" title-tag="h1">
                <?= $category->metaDescription ?>
            </copy-block>
            <div>
                <?= $baseViewModel->renderLazyLoad('hero_term.png', $category->title_long, new AssetSizeInstruction(520, 520)) ?>
            </div>
        </div>
    </div>
</page-header>


<main>
    <section>
        <div class="container">
            <div class="wrapper">


                <div class="row rowGapExtraLarge">
                    <?php
                    /**
                     * Tagbar
                     */
                    $categoriesTagBar = $block->getLayout()->createBlock(Template::class, 'tags', ['data' => ['template' => 'Liquid_Content::element/tagbar.phtml']]);

                    /** @var $tagBarViewModel TagBar */
                    $tagBarViewModel = $baseViewModel->getObjectManager()->create(TagBar::class);
                    $tagBarViewModel->setTags($viewModel->getCategories());
                    $tagBarViewModel->setCurrent($category);
                    $tagBarViewModel->setAllTarget($baseViewModel->getResolver()->getUrl('blog'));

                    $categoriesTagBar->setViewModel($tagBarViewModel)
                            ->setViewModel($baseViewModel, 'base');
                    echo $categoriesTagBar->toHtml();

                    /**
                     * Posts
                     */
                    /** @var PostList $postListViewmodel */
                    $postListViewmodel = $baseViewModel->getObjectManager()->create(PostList::class);
                    $postListViewmodel->setPosts($posts);

                    $postListBlock = $block->getLayout()->createBlock(Template::class, 'post-list');
                    $postListBlock
                            ->setTemplate('Liquid_Blog::post/list.phtml')
                            ->setViewModel($postListViewmodel)
                            ->setViewModel($baseViewModel, 'base');
                    echo $postListBlock->toHtml();


                    ?>
                </div>
            </div>
        </div>

    </section>
    <call-to-action>

    </call-to-action>
</main>
