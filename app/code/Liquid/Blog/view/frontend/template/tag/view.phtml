<?php
declare(strict_types=1);

/**
 * @var $this TemplateEngine
 * @var $block Template
 * @var $viewModel Tag
 * @var $baseViewModel BaseViewModel
 */

use Liquid\Blog\Model\ViewModel\PostList;
use Liquid\Blog\Model\ViewModel\Tag;
use Liquid\Content\ViewModel\BaseViewModel;
use Liquid\Content\ViewModel\TagBar;
use Liquid\Framework\View\Element\Template;
use Liquid\Framework\View\TemplateEngine;

$viewModel = $block->getViewModel('', Tag::class);
$baseViewModel = $block->getViewModel('base', BaseViewModel::class);

$tag = $viewModel->getTag();
$posts = $viewModel->getPosts();
?>

<page-header>

    <div class="row">
        <div class="column">
            <copy-block title="Posts tagged <?= $tag->metaTitle ?>" caption="Blog" title-tag="h1">

            </copy-block>
        </div>
    </div>
</page-header>


<main>
    <section>
        <div class="container">
            <div class="wrapper">


                <div class="row rowGapExtraLarge">
                    <?php
                    /**
                     * Tagbar
                     */
                    $categoriesTagBar = $block->getLayout()->createBlock(Template::class, 'tags', ['data' => ['template' => 'Liquid_Content::element/tagbar.phtml']]);

                    /** @var $tagBarViewModel TagBar */
                    $tagBarViewModel = $baseViewModel->getObjectManager()->create(TagBar::class);
                    $tagBarViewModel->setTags($viewModel->getTags());
                    $tagBarViewModel->setCurrent($tag);
                    $tagBarViewModel->setAllTarget($baseViewModel->getResolver()->getUrl('blog'));

                    $categoriesTagBar->setViewModel($tagBarViewModel);
                    $categoriesTagBar->setViewModel($baseViewModel, 'base');
                    echo $categoriesTagBar->toHtml();

                    /**
                     * Posts
                     */
                    /** @var PostList $postListViewmodel */
                    $postListViewmodel = $baseViewModel->getObjectManager()->create(PostList::class);
                    $postListViewmodel->setPosts($posts);

                    $postListBlock = $block->getLayout()->createBlock(Template::class, 'post-list');

                    $postListBlock
                            ->setViewModel($postListViewmodel)
                            ->setViewModel($baseViewModel, 'base')
                            ->setTemplate('Liquid_Blog::post/list.phtml');
                    echo $postListBlock->toHtml();


                    ?>
                </div>
            </div>
        </div>

    </section>
    <call-to-action>

    </call-to-action>
</main>
